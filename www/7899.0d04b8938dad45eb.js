"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7899],{7899:(J,h,c)=>{c.r(h),c.d(h,{CustomerOrderSummaryPageModule:()=>q});var x=c(6814),A=c(95),m=c(9004),O=c(2436),v=c(5861),C=c(1273),e=c(5678),Z=c(4414),T=c(5565),k=c(6593);function D(r,d){if(1&r&&(e.TgZ(0,"ion-row",16)(1,"ion-col",17)(2,"ion-text",21),e._uU(3),e.qZA()(),e.TgZ(4,"ion-col",19)(5,"ion-text",35),e._uU(6),e._UZ(7,"ion-icon",36),e._uU(8),e.qZA()(),e.TgZ(9,"ion-col",37)(10,"ion-text",38),e._uU(11),e.qZA()()()),2&r){const n=d.$implicit;e.xp6(3),e.Oqu(n.name),e.xp6(3),e.hij("\u20b9 ",n.price," "),e.xp6(2),e.Oqu(n.count),e.xp6(3),e.hij(" = \u20b9",n.individualItemCost,"")}}function P(r,d){1&r&&(e.TgZ(0,"ion-text",39),e._uU(1,"Delivery Location"),e.qZA())}function U(r,d){1&r&&(e.TgZ(0,"ion-text",39),e._uU(1,"Pickup Location"),e.qZA())}function w(r,d){if(1&r){const n=e.EpF();e.TgZ(0,"ion-col",40),e.NdJ("click",function(){e.CHM(n);const t=e.oxw(2);return e.KtG(t.openAddressList())}),e.TgZ(1,"ion-button",41),e._uU(2,"Change Address"),e.qZA()()}}function b(r,d){1&r&&(e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-text",42),e._uU(3,"Note: Customer will pickup order on their own."),e.qZA()()())}function S(r,d){if(1&r){const n=e.EpF();e.TgZ(0,"ion-content",6)(1,"div",7)(2,"ion-row")(3,"ion-col",8)(4,"div",9)(5,"ion-text",10),e._uU(6,"R"),e.qZA()(),e.TgZ(7,"ion-text",11)(8,"span",10),e._uU(9),e.qZA(),e._UZ(10,"br"),e.TgZ(11,"span"),e._uU(12),e.qZA(),e._UZ(13,"br"),e.TgZ(14,"span"),e._uU(15),e.qZA()()()(),e.TgZ(16,"ion-row")(17,"ion-col",12)(18,"ion-text",10),e._uU(19),e.qZA()()(),e.TgZ(20,"ion-row")(21,"ion-col",13)(22,"div",14),e.YNc(23,D,12,4,"ion-row",15),e.TgZ(24,"ion-row",16)(25,"ion-col",17)(26,"ion-text",18),e._uU(27,"GST"),e.qZA()(),e.TgZ(28,"ion-col",19)(29,"ion-text",20),e._uU(30),e.qZA()()(),e.TgZ(31,"ion-row",16)(32,"ion-col",17)(33,"ion-text",18),e._uU(34),e.qZA()(),e.TgZ(35,"ion-col",19)(36,"ion-text",20),e._uU(37),e.qZA()()(),e.TgZ(38,"ion-row",16)(39,"ion-col",17)(40,"ion-text",21),e._uU(41,"Total"),e.qZA()(),e.TgZ(42,"ion-col",19)(43,"ion-text",21),e._uU(44),e.qZA()()()()()(),e.TgZ(45,"ion-row",22)(46,"ion-col")(47,"div",8),e._UZ(48,"ion-icon",23),e.YNc(49,P,2,0,"ion-text",24)(50,U,2,0,"ion-text",24),e.qZA()(),e.YNc(51,w,3,0,"ion-col",25),e.qZA(),e.YNc(52,b,4,0,"ion-row",26),e.TgZ(53,"ion-row")(54,"ion-col"),e._UZ(55,"ion-text",27),e.qZA()(),e.TgZ(56,"ion-row",28)(57,"ion-col",29)(58,"div",30),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.copyLocationUrl())}),e._UZ(59,"ion-icon",31),e.TgZ(60,"ion-text",32),e._uU(61,"Copy"),e.qZA()(),e.TgZ(62,"ion-button",33),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.redirectToGoogleMaps())}),e._uU(63,"Get Directions"),e.qZA()()(),e.TgZ(64,"ion-button",34),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.placeOrder())}),e._uU(65,"PAY NOW"),e.qZA()()()}if(2&r){const n=e.oxw();e.Q6J("fullscreen",!0),e.xp6(9),e.hij("Maker ",null==n.orderData||null==n.orderData.makerData?null:n.orderData.makerData.ID,""),e.xp6(3),e.Oqu(null==n.orderData||null==n.orderData.makerData?null:n.orderData.makerData.userName),e.xp6(3),e.Oqu(null==n.orderData||null==n.orderData.makerData?null:n.orderData.makerData.address),e.xp6(4),e.Oqu(null==n.orderData||null==n.orderData.listingData?null:n.orderData.listingData.label),e.xp6(4),e.Q6J("ngForOf",null==n.orderData?null:n.orderData.orderedItems),e.xp6(7),e.hij("\u20b9 ",n.orderData.gst,""),e.xp6(4),e.hij("Delivery (",null==n.orderData||null==n.orderData.deliveryOption?null:n.orderData.deliveryOption.type,")"),e.xp6(3),e.hij("\u20b9 ",null==n.orderData||null==n.orderData.deliveryOption?null:n.orderData.deliveryOption.price,""),e.xp6(7),e.hij(" \u20b9",n.parsePrice(null==n.orderData?null:n.orderData.finalCostWithOutDeliveryOption)+n.parsePrice(null==n.orderData?null:n.orderData.deliveryOption.price)+n.parsePrice(n.orderData.gst)," "),e.xp6(5),e.Q6J("ngIf","Pickup Available"!=n.orderData.deliveryOption.type),e.xp6(1),e.Q6J("ngIf","Pickup Available"==n.orderData.deliveryOption.type),e.xp6(1),e.Q6J("ngIf","Pickup Available"!=n.orderData.deliveryOption.type),e.xp6(1),e.Q6J("ngIf","Pickup Available"==n.orderData.deliveryOption.type),e.xp6(3),e.Q6J("innerHTML",n.getSanitizedLocationUrl(),e.oJD)}}function I(r,d){1&r&&(e.TgZ(0,"ion-content",43)(1,"div",44),e._UZ(2,"ion-icon",45),e.TgZ(3,"p",46),e._uU(4,"Data not found. Please try again."),e.qZA()()()),2&r&&(e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("@fadeInOut",void 0))}let L=(()=>{var r;class d{constructor(o,t,a,i,l,s){this.router=o,this.model=t,this.alert=a,this.adminService=i,this.sanitizer=l,this.alertController=s,this._id="",this.addressList=[]}ngOnInit(){}ngAfterViewInit(){var o=this;return(0,v.Z)(function*(){const t=yield o.adminService.presentLoading();o._id=o.router.url.split("/")[2],o.adminService.getCustomerAddress({}).subscribe(a=>{var i;o.addressList=a.data||[],o.selectedAddress=null===(i=o.addressList)||void 0===i?void 0:i.find(l=>l.default),t.dismiss()},a=>{t.dismiss(),o.addressList=[]}),o.adminService.getCustomerOrderSummary({_id:o._id}).subscribe(a=>{var i;a.success&&a.data?(o.orderData=a.data,o.orderData.gst=Math.round(.05*(null===(i=o.orderData)||void 0===i?void 0:i.finalCostWithOutDeliveryOption))):o.orderData=!1,t.dismiss()},a=>{t.dismiss(),o.orderData=!1,o.openAlert("ERROR","something went wrong please try again later",["close"])})})()}parsePrice(o){return parseFloat(o||"0")}openAddressList(){var o=this;return(0,v.Z)(function*(){const t=yield o.model.create({component:C.z});t.present();const{data:a}=yield t.onWillDismiss();a&&a._id&&(o.selectedAddress=a)})()}goBack(){this.adminService.deleteTempOrder({_id:this._id}).subscribe(o=>{this.orderData.refListingId?this.router.navigateByUrl("/customerListings/"+this.orderData.refListingId):this.router.navigate(["/customerListings"])},o=>{console.log(o)})}placeOrder(){var o=this;return(0,v.Z)(function*(){var t;if(null!==(t=o.selectedAddress)&&void 0!==t&&t._id){const s=yield o.adminService.presentLoading();try{var a,i,l;let p=(null===(a=o.orderData)||void 0===a?void 0:a.finalCostWithOutDeliveryOption)+((null===(i=o.orderData)||void 0===i||null===(i=i.deliveryOption)||void 0===i?void 0:i.price)||0)+(null===(l=o.orderData)||void 0===l?void 0:l.gst)||0;o.adminService.createOrderInRazorPay({_id:o.orderData._id,amount:100*p,receipt:"order_rcptid_11",currency:"INR"}).subscribe(_=>{let y=_.order||{};_.success&&y.id?o.adminService.payWithRazorpay(y.id,p,o.orderData._id).then(f=>{var u;f?o.adminService.placeOrder({_id:o._id,paymentDetails:f,deliveryAddress:{...o.selectedAddress,commision:(null===(u=o.orderData)||void 0===u||null===(u=u.makerData)||void 0===u?void 0:u.commission)||0}}).subscribe(g=>{s.dismiss(),g.success&&o.router.navigate(["/orders"])},g=>{410==g.status?(s.dismiss(),o.openAlert("OUT OF STOCK","We're sorry, but some items in your order are currently out of stock. We're working to restock our inventory soon. Please remove the out-of-stock items or adjust the quantities, or contact our support team for further assistance. Thank you for your understanding.",["close"])):(s.dismiss(),o.openAlert("ERROR","something went wrong please try again later",["close"]))}):(s.dismiss(),o.adminService.savePaymentFailedDetails({tempOrderId:o.orderData._id,razorPayOrderDetails:y,...f}).subscribe(g=>{console.log(g)},g=>{console.log(g)}))}).catch(f=>{s.dismiss(),o.adminService.savePaymentFailedDetails({tempOrderId:o.orderData._id,razorPayOrderDetails:y,...f}).subscribe(u=>{console.log(u)},u=>{console.log(u)}),o.openAlert("ERROR",`${f.message}`,["close"])}):(s.dismiss(),o.openAlert("ERROR","something went wrong please try again later",["close"]))},_=>{s.dismiss(),o.openAlert("ERROR",`${_.message}`,["close"])})}catch(p){s.dismiss(),console.log("Error creating order",p)}}else console.log("address not found")})()}openAlert(o,t,a){var i=this;return(0,v.Z)(function*(){yield(yield i.alert.create({header:o,message:t,buttons:a,mode:"ios"})).present()})()}getSanitizedLocationUrl(){var o,t;let a=(null===(o=this.selectedAddress)||void 0===o?void 0:o.LocationUrl)||"";var i,l;return a="Pickup Available"!=(null===(t=this.orderData.deliveryOption)||void 0===t?void 0:t.type)?null===(i=this.selectedAddress)||void 0===i?void 0:i.LocationUrl:null===(l=this.orderData)||void 0===l||null===(l=l.listingData)||void 0===l?void 0:l.address,!a&&this.orderData&&this.orderData.deliveryAddress&&(a=this.orderData.deliveryAddress.LocationUrl||""),this.sanitizer.bypassSecurityTrustHtml(a.replace(/,/g,",<br>"))}copyLocationUrl(){var o=this;return(0,v.Z)(function*(){var t,a;let i=null===(t=o.selectedAddress)||void 0===t?void 0:t.LocationUrl;var l,s;if(i="Pickup Available"!=(null===(a=o.orderData.deliveryOption)||void 0===a?void 0:a.type)?null===(l=o.selectedAddress)||void 0===l?void 0:l.LocationUrl:null===(s=o.orderData)||void 0===s||null===(s=s.listingData)||void 0===s?void 0:s.address,i){const p=document.createElement("input");p.value=i,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),yield(yield o.alertController.create({header:"Copied!",message:"Location URL copied successfully",buttons:["OK"]})).present()}})()}redirectToGoogleMaps(){var o,t,a,i;"Pickup Available"!=(null===(o=this.orderData.deliveryOption)||void 0===o?void 0:o.type)&&null!==(t=this.selectedAddress)&&void 0!==t&&t.LocationUrl?window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(null===(a=this.selectedAddress)||void 0===a?void 0:a.LocationUrl)}`,"_blank"):window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(null===(i=this.orderData)||void 0===i||null===(i=i.listingData)||void 0===i?void 0:i.address)}`,"_blank")}}return(r=d).\u0275fac=function(o){return new(o||r)(e.Y36(O.F0),e.Y36(Z.IN),e.Y36(Z.Br),e.Y36(T.l),e.Y36(k.H7),e.Y36(Z.Br))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-customer-order-summary"]],decls:8,vars:3,consts:[[2,"box-shadow","none",3,"translucent"],[2,"padding","5px 10px 0px 10px"],[1,"kd_flex","kd_end_align",3,"click"],["name","close-outline",1,"kd_svg_size"],[3,"fullscreen",4,"ngIf"],["class","ion-padding",3,"fullscreen",4,"ngIf"],[3,"fullscreen"],[2,"margin","15px"],[1,"kd_flex"],[1,"first_letter_styles"],[2,"font-weight","bold"],[2,"padding-left","20px","font-size","13px"],[2,"margin-top","10px"],[1,"kd_flex_row_center",2,"margin","5px 0px"],[2,"border","solid 2px","border-radius","14px","padding","10px","background-color","#f7f7f7"],["class","kd_flex kd_center_align",4,"ngFor","ngForOf"],[1,"kd_flex","kd_center_align"],["size","8"],[2,"font-size","14px","color","#777"],["size","4",1,"kd_flex","kd_end_align"],[2,"font-size","14px","color","#555"],[2,"font-size","16px","font-weight","bold"],[2,"margin-top","15px","display","flex","align-items","center"],["name","home-outline",1,"icon_style"],["style","font-weight: bold; font-size: 18px;",4,"ngIf"],["class","ion-no-padding",3,"click",4,"ngIf"],[4,"ngIf"],[2,"font-size","14px",3,"innerHTML"],[2,"margin","20px 0px"],[1,"kd_center_align_items"],[1,"kd_center_align_items",3,"click"],["name","copy-outline",2,"height","30px","width","30px"],[2,"margin-left","5px"],[2,"margin-left","35px","width","fit-content",3,"click"],[2,"width","100%","margin-top","10%",3,"click"],[1,"kd_flex",2,"font-size","14px","color","black","font-weight","bold"],["name","close-outline",1,"icon_style",2,"padding-right","5px","padding-left","5px"],[1,"kd_flex","kd_end_align","ion-no-padding",2,"padding-right","5px","padding-bottom","10px"],[2,"font-weight","bold","font-size","14px"],[2,"font-weight","bold","font-size","18px"],[1,"ion-no-padding",3,"click"],[2,"margin","0px"],[2,"font-size","14px !important"],[1,"ion-padding",3,"fullscreen"],[1,"error-container"],["name","alert-circle",1,"error-icon"],[1,"error-message"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-row",1),e._UZ(3,"ion-col"),e.TgZ(4,"ion-col",2),e.NdJ("click",function(){return t.goBack()}),e._UZ(5,"ion-icon",3),e.qZA()()()(),e.YNc(6,S,66,15,"ion-content",4)(7,I,5,2,"ion-content",5)),2&o&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("ngIf",t.orderData),e.xp6(1),e.Q6J("ngIf",!1===t.orderData))},dependencies:[x.sg,x.O5,m.YG,m.wI,m.W2,m.Gu,m.gu,m.Nd,m.yW,m.sr],styles:[".error-container[_ngcontent-%COMP%]{text-align:center}.error-icon[_ngcontent-%COMP%]{font-size:4em;color:#f44336}.error-message[_ngcontent-%COMP%]{font-size:1.2em;color:#f44336}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1}to{opacity:0}}.fadeInOut[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out forwards,fadeOut .5s ease-in-out forwards}"]}),d})();var z=c(3609);const R=[{path:"",component:L}];let M=(()=>{var r;class d{}return(r=d).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[z.m,O.Bz.forChild(R),O.Bz]}),d})(),q=(()=>{var r;class d{}return(r=d).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[x.ez,A.u5,m.Pc,M]}),d})()}}]);